<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>法律論述マインドマップ (トグル機能付き)</title>
<style>
body {
  font-family: 'Meiryo', 'Hiragino Kaku Gothic ProN', sans-serif;
  font-size: 13px;
  line-height: 1.5;
  margin: 0;
  padding: 10px; /* ページ全体のパディングは維持、コンテナのはみ出しはoverflowで制御 */
  background-color: #ffffff;
  color: #333333;
}

.mindmap-container {
  display: flex;
  /* width: 100%; */ /* JSで制御するため、widthは必須ではないが、あっても害はない */
  overflow: hidden; /* はみ出し防止 */
  /* heightはJSで動的に指定 */
}

.mindmap {
  list-style-type: none;
  padding-left: 0;
  position: relative;
}

.mindmap ul {
  list-style-type: none;
  padding-left: 20px;
  position: relative;
}

.mindmap li {
  margin: 5px 0;
  position: relative;
}

.node {
  padding: 4px 8px;
  border-radius: 5px;
  border: 1px solid #d1ccc0;
  display: inline-block;
  box-shadow: 1px 1px 3px rgba(0,0,0,0.05);
  transition: background-color 0.2s ease, color 0.2s ease; /* ホバー時の色変化をスムーズに */
  white-space: nowrap;
  cursor: default; /* デフォルトカーソル */
}

/* トグル可能なノードのスタイル */
.node.toggleable {
  cursor: pointer; /* トグル可能なノードはポインターに */
}
.node.toggleable:hover {
  background-color: #e0e0e0; /* ホバー時の背景色を少し変える */
}

/* トグルアイコンのスタイル */
.toggler-icon {
  display: inline-block;
  margin-right: 4px;
  font-weight: bold;
  width: 1em; /* アイコンの幅を固定 */
  text-align: center;
}


/* 階層ごとの色分け (パステルカラー) */
.level-0 { background-color: #b2dfdb; color: #004d40; border-color: #80cbc4; }
.level-1 { background-color: #bbdefb; color: #0d47a1; border-color: #90caf9; }
.level-2 { background-color: #c8e6c9; color: #1b5e20; border-color: #a5d6a7; }
.level-3 { background-color: #fff9c4; color: #795548; border-color: #fff59d; }
.level-4 { background-color: #ffccbc; color: #bf360c; border-color: #ffab91; }
.level-5 { background-color: #d1c4e9; color: #311b92; border-color: #b39ddb; }
.level-6 { background-color: #b2ebf2; color: #006064; border-color: #80deea; }

.issue { background-color: #ffcdd2; color: #c62828; border-color: #ef9a9a; font-weight: bold; }
.conclusion { background-color: #cfd8dc; color: #263238; border-color: #b0bec5; }

/* 非表示のスタイル */
.hidden {
  display: none !important;
}

/* 簡単なコネクタ風の線 (オプション) - 位置調整 */
.mindmap li::before {
  content: "";
  position: absolute;
  left: -10px;
  top: 0;
  bottom: 0;
  width: 1px;
}
.mindmap li:not(:last-child)::before {
   border-left: 1px solid #b0bec5;
}
.mindmap li:last-child::before {
    height: 0.9em;
    border-left: 1px solid #b0bec5;
}

.mindmap li > .node-container > .node::after { /* .node-container を挟む */
  content: "";
  position: absolute;
  left: -10px;
  top: 0.9em;
  width: 9px;
  border-top: 1px solid #b0bec5;
}

.mindmap > li::before {
  display: none;
}
.mindmap > li > .node-container + ul > li:first-child::before { /* .node-container を挟む */
    top: -5px;
}
/* ルートノードのノード本体の横線は不要 */
.mindmap > li > .node-container > .node::after {
    display: none;
}


.crime-name { font-weight: bold; }
.article-ref { font-size: 0.85em; }
.node .article-ref { opacity: 0.8; }

/* ノードとトグルアイコンをまとめるコンテナ */
.node-container {
    display: inline-flex; /* アイコンとノードテキストを横並びにする */
    align-items: center; /* 垂直方向中央揃え */
}

</style>
</head>
<body>

<div class="mindmap-container">
  <ul class="mindmap">
    <li>
      <div class="node-container">
        <span class="node level-0">【講師作成論述例】</span>
      </div>
      <ul>
        <li>
          <div class="node-container">
            <span class="node level-1">1 乙の罪責</span>
          </div>
          <ul>
            <li>
              <div class="node-container">
                <span class="node level-2">(1) Aを山中の土中に埋めた行為に<span class="crime-name">殺人罪 (199条)</span>が成立するか。</span>
              </div>
              <ul>
                <li>
                  <div class="node-container">
                    <span class="node level-3">ア 実行行為性・因果関係</span>
                  </div>
                  <ul>
                    <li><div class="node-container"><span class="node level-4">土中埋没→酸素供給断絶・土の重み→窒息死の現実的危険性</span></div></li>
                    <li><div class="node-container"><span class="node level-4">A死亡、因果関係あり</span></div></li>
                  </ul>
                </li>
                <li>
                  <div class="node-container">
                    <span class="node level-3">イ 故意 <span class="article-ref">(38条1項)</span></span>
                  </div>
                  <ul>
                    <li><div class="node-container"><span class="node level-4">Aを生き埋めにして殺害する意図</span></div></li>
                  </ul>
                </li>
                <li><div class="node-container"><span class="node level-3 conclusion">(2) 上記行為に殺人罪成立、乙はその罪責を負う</span></div></li>
              </ul>
            </li>
          </ul>
        </li>
        <li>
          <div class="node-container">
            <span class="node level-1">2 甲の罪責</span>
          </div>
          <ul>
            <li>
              <div class="node-container">
                <span class="node level-2">(1) 花瓶でAの後頭部を殴打した行為（本件行為）に<span class="crime-name">殺人罪 (199条)</span>が成立するか。</span>
              </div>
              <ul>
                <li>
                  <div class="node-container">
                    <span class="node level-3">ア 実行行為性</span>
                  </div>
                  <ul>
                    <li><div class="node-container"><span class="node level-4">身体枢要部(後頭部)を固いクリスタルガラス花瓶で力任せに殴打</span></div></li>
                    <li><div class="node-container"><span class="node level-4">Aの生命侵害の現実的危険性あり</span></div></li>
                  </ul>
                </li>
                <li>
                  <div class="node-container">
                    <span class="node level-3">イ 因果関係</span>
                  </div>
                  <ul>
                    <li><div class="node-container"><span class="node level-4 issue">介在事情があるため、本件行為とAの死亡との因果関係が問題</span></div></li>
                    <li>
                      <div class="node-container">
                        <span class="node level-5">判断基準: ①条件関係 + ②行為の危険性が結果へと現実化</span>
                      </div>
                        <ul>
                            <li><div class="node-container"><span class="node level-6">②考慮要素: 介在事情の異常性、介在事情の結果への因果的寄与度</span></div></li>
                        </ul>
                    </li>
                    <li>
                      <div class="node-container">
                        <span class="node level-5">(イ) 本件への適用</span>
                      </div>
                      <ul>
                        <li><div class="node-container"><span class="node level-6">① 条件関係: 認められる(甲が殴打しなければAは死ななかった)</span></div></li>
                        <li>
                          <div class="node-container">
                            <span class="node level-6">② 危険性の現実化:</span>
                          </div>
                            <ul>
                                <li><div class="node-container"><span class="node level-4">介在事情(乙による埋没行為)の寄与度: Aは窒息死のため大</span></div></li>
                                <li><div class="node-container"><span class="node level-4">介在事情の異常性: 殺害後の罪証隠滅のための死体遺棄は経験則上あり得る→低い</span></div></li>
                                <li><div class="node-container"><span class="node level-4">結論: 本件行為は埋められて窒息死する危険性を含み、それが現実化した</span></div></li>
                            </ul>
                        </li>
                      </ul>
                    </li>
                    <li><div class="node-container"><span class="node level-5 conclusion">(ウ) 因果関係認められる</span></div></li>
                  </ul>
                </li>
                <li>
                  <div class="node-container">
                    <span class="node level-3">ウ 故意（因果関係の錯誤）</span>
                  </div>
                  <ul>
                     <li><div class="node-container"><span class="node level-4 issue">本件行為が直接の原因で死亡と認識(因果経過の錯誤)で故意が認められるか</span></div></li>
                     <li><div class="node-container"><span class="node level-5">(ア) 理論: 因果関係は客観的構成要件要素であり故意の認識対象。主観と客観が同一構成要件内で符合すれば故意あり。</span></div></li>
                     <li><div class="node-container"><span class="node level-5">(イ) 本件: 客観的因果関係あり。甲は上記行為でA死亡と認識。同一構成要件内で符合。</span></div></li>
                     <li><div class="node-container"><span class="node level-5 conclusion">(ウ) 故意認められる</span></div></li>
                  </ul>
                </li>
                <li><div class="node-container"><span class="node level-3 conclusion">工 上記行為に殺人罪成立</span></div></li>
              </ul>
            </li>
            <li>
              <div class="node-container">
                <span class="node level-2">(2) 甲が乙と共に、Aを山中の土中に埋めた行為に<span class="crime-name">殺人罪</span>が成立するか。</span>
              </div>
              <ul>
                <li><div class="node-container"><span class="node level-3">ア 客観的構成要件: 該当する(外形的には殺害行為)</span></div></li>
                <li><div class="node-container"><span class="node level-3">イ 故意: 甲はAが死亡したものと考えており、<span class="crime-name">死体遺棄罪 (190条)</span>の故意しかない</span></div></li>
                <li><div class="node-container"><span class="node level-3 conclusion">ウ 殺人罪不成立</span></div></li>
              </ul>
            </li>
            <li>
              <div class="node-container">
                <span class="node level-2">(3) （上記殺人罪不成立だとしても）埋めた行為に<span class="crime-name">死体遺棄罪</span>が成立するか。</span>
              </div>
              <ul>
                <li>
                  <div class="node-container">
                    <span class="node level-3">ア 客観的構成要件該当性</span>
                  </div>
                  <ul>
                    <li><div class="node-container"><span class="node level-4 issue">客観的構成要件該当性が問題</span></div></li>
                    <li><div class="node-container"><span class="node level-5">(ア) 理論: 構成要件は保護法益と行為態様に着目。重なり合いがあればその範囲で該当性認める。</span></div></li>
                    <li><div class="node-container"><span class="node level-5">(イ) 本件: 殺人罪と死体遺棄罪では保護法益(生命 vs 国民の宗教感情)、行為対象(生体 vs 死体)が異なる。構成要件の重なり合いなし。</span></div></li>
                    <li><div class="node-container"><span class="node level-5 conclusion">(ウ) 死体遺棄罪の客観的構成要件に該当しない</span></div></li>
                  </ul>
                </li>
                <li><div class="node-container"><span class="node level-3 conclusion">イ 死体遺棄罪不成立。A生存に気付かなかった過失 → <span class="crime-name">過失致死罪 (210条)</span>成立にとどまる</span></div></li>
              </ul>
            </li>
            <li>
              <div class="node-container">
                <span class="node level-2 conclusion">(4) 甲の罪責まとめ</span>
              </div>
                <ul>
                    <li><div class="node-container"><span class="node level-3">殺人罪(花瓶での殴打)と過失致死罪(埋没行為)の罪責を負う</span></div></li>
                    <li><div class="node-container"><span class="node level-3">これらは包括一罪となる</span></div></li>
                </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // 既存のトグル機能
  const mindmapItems = document.querySelectorAll('.mindmap li');

  mindmapItems.forEach(item => {
    const nodeContainer = item.querySelector(':scope > .node-container'); // 直下のnode-containerのみ選択
    const nodeElement = nodeContainer ? nodeContainer.querySelector('.node') : null;
    const sublist = item.querySelector(':scope > ul'); // 直下の子ulのみ選択

    if (nodeElement && sublist) {
      // トグルアイコンを作成してノードの前に追加
      const toggler = document.createElement('span');
      toggler.classList.add('toggler-icon');
      toggler.textContent = '[-]'; // 初期状態は展開されているので「-」
      nodeContainer.insertBefore(toggler, nodeElement);
      nodeElement.classList.add('toggleable'); // クリック可能であることを示すクラス

      // ノードまたはアイコンのクリックイベント
      const toggleAction = () => {
        sublist.classList.toggle('hidden');
        if (sublist.classList.contains('hidden')) {
          toggler.textContent = '[+]';
        } else {
          toggler.textContent = '[-]';
        }
      };

      // ノード自体（テキスト部分）をクリックしてもトグルするようにする
      nodeElement.addEventListener('click', toggleAction);
      // アイコンをクリックしてもトグルするようにする
      toggler.addEventListener('click', toggleAction);

    } else if (nodeElement) {
        // 子要素がない場合は、アイコンのスペースを確保するためダミーのトグラーを追加（表示はしない）
        const dummyToggler = document.createElement('span');
        dummyToggler.classList.add('toggler-icon');
        dummyToggler.innerHTML = '&nbsp;'; // 空白文字でスペース確保
        if(nodeContainer){ // nodeContainer が存在する場合のみ挿入
            nodeContainer.insertBefore(dummyToggler, nodeElement);
        }
    }
  });

  // ★全体自動縮小スクリプト
  function fitMindmapToScreen() {
    const container = document.querySelector('.mindmap-container');
    const mindmap = container.querySelector('.mindmap');
    if (!container || !mindmap) return;
    
    // 一旦リセットして正確な幅を測るため
    container.style.transform = '';
    container.style.transformOrigin = 'left top'; // 常に左上を基点に
    container.style.height = ''; // 高さもリセット

    // マインドマップ本体の実際の幅と高さを取得
    const mindmapScrollWidth = mindmap.scrollWidth;
    const mindmapScrollHeight = mindmap.scrollHeight; // スケール前の高さを取得

    // スクロールバー分除外しつつ、viewport幅を基準に計算
    // bodyのpaddingを考慮する場合、clientWidthから引く
    const bodyPadding = parseFloat(getComputedStyle(document.body).paddingLeft) + parseFloat(getComputedStyle(document.body).paddingRight);
    const viewportWidth = window.innerWidth - bodyPadding; // 左右のpaddingを引く

    // 縮小倍率（ただし1以上には拡大しない）
    let scale = viewportWidth / mindmapScrollWidth;
    if (scale > 1) scale = 1;
    if (scale <= 0) scale = 1; // 念のため0以下にならないように

    container.style.transform = 'scale(' + scale + ')';
    
    // スケール後のコンテナ高さ分だけコンテナ自身の高さを設定（親要素のレイアウト崩れ防止）
    // かつ、マインドマップがコンテナからはみ出ないようにする
    container.style.width = mindmapScrollWidth + 'px'; // スケール前の幅を設定しておくことで、スケールが正しくかかる
    container.style.height = (mindmapScrollHeight * scale) + 'px';
  }

  // 初回、リサイズ時にも実行
  window.addEventListener('resize', fitMindmapToScreen);
  fitMindmapToScreen(); // 初回実行

  // フォント読み込みや画像読み込み後にも再計算するとより確実だが、今回はテキストのみなのでresizeと初回でほぼ問題ない
  // 場合によっては new ResizeObserver(fitMindmapToScreen).observe(mindmap); のような高度な監視も検討
});
</script>

</body>
</html>